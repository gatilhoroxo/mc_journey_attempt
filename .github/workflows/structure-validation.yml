name: ðŸ—ï¸ Repository Structure Validation

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  validate-structure:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ðŸ” Validate directory structure
      run: |
        bash .meta/scripts/validate-structure.sh
        
    - name: ðŸ“Š Check required files
      run: |
        echo "### Structure Validation" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        # Verificar principais READMEs
        FILES=(
          "README.md"
          "learn/README.md"
          "mcu/README.md"
          "docs/README.md"
          "projetos-integrados/README.md"
        )
        
        for file in "${FILES[@]}"; do
          if [ -f "$file" ]; then
            echo "âœ… $file" >> $GITHUB_STEP_SUMMARY
          else
            echo "âŒ Missing: $file" >> $GITHUB_STEP_SUMMARY
          fi
        done
        
    - name: ðŸ“ˆ Count exercises
      run: |
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Exercise Statistics" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        for mcu in i0-arduino i1-esp32 i2-rp2040-a i3-rp2040-zero i4-stm8; do
          count=$(find "mcu/$mcu/j1-exercicios" -type d -name "k*" 2>/dev/null | wc -l)
          echo "- **$mcu:** $count exercises" >> $GITHUB_STEP_SUMMARY
        done
